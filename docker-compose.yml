version: '3.9'

services:
  app:
    build: ./server
    # command: >
    #   sh -c "DOCKERTODO bash commands here"
    volumes:
      - ./server:/code
    ports:
      - '3001:3001' # ? looks like this one is being used
    environment:
      - DEBUG=True
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - JWT_SECRET=${JWT_SECRET}
      - PUBLIC_VAPID_KEY=${PUBLIC_VAPID_KEY}
      - PRIVATE_VAPID_KEY=${PRIVATE_VAPID_KEY}
      - WEB_PUSH_CONTACT="sender@example.com"
      - IOS_DRIVER_ARN=${IOS_DRIVER_ARN}
      - IOS_RIDER_ARN=${IOS_RIDER_ARN}
      - ANDROID_ARN=${ANDROID_ARN}
      - HOSTNAME=${HOSTNAME}
      - USE_HOSTNAME=false
    # depends_on:
    #   - DOCKERTODO (any other volumes)
    networks:
      - networkone
  frontend:
    build: ./frontend
    #    command: nginx -g daemon off # not sure if this is necessary, honestly
    ports:
      - '3000:3000' # ? looks like this one is being used
      # - '443:443' # ?
    environment:
      - REACT_APP_CLIENT_ID=${REACT_APP_CLIENT_ID}
      - REACT_APP_PUBLIC_VAPID_KEY=${REACT_APP_PUBLIC_VAPID_KEY}
      - CHOKIDAR_USEPOLLING=true
    depends_on:
      - app
    volumes:
      - ./frontend/certbot:/etc/letsencrypt
      - ./frontend/certbot/www:/var/www/certbot/:ro
    networks:
      - networkone
  certbot:
    image: certbot/certbot:latest
    volumes:
      - ./frontend/certbot:/etc/letsencrypt
      - ./frontend/certbot/www:/var/www/certbot/:rw
    networks:
      - networkone
networks:
  networkone:
